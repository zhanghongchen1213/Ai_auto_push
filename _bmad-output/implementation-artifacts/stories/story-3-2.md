# Story 3-2: 搜索结果展示与跳转

## Story ID
3-2

## Epic
Epic 3: 搜索功能

## 标题
搜索结果展示与跳转

## 描述
作为用户，
我想要从搜索结果直接跳转到对应的资讯详情页面，
以便快速阅读完整内容和访问原文链接。

## 优先级
P1

## 复杂度
低

## 状态
done

## 依赖
- Story 3-1: Pagefind 搜索集成与搜索页面（已完成）
- Story 1-4: 每日资讯首页与新闻卡片组件（已完成）
- Story 2-1: 日期动态路由与历史页面（已完成）

---

## 验收标准 (Acceptance Criteria)

### AC-1: 搜索结果卡片展示领域与日期信息
**Given** 用户已在 /search/ 页面执行搜索并获得匹配结果
**When** 搜索结果列表渲染完成
**Then** 每条搜索结果卡片显示所属领域的 pill 标签（使用领域专属色彩编码）
**And** 每条搜索结果卡片显示资讯的发布日期
**And** 搜索结果复用 NewsCard 卡片组件，保持与首页视觉风格一致（FR14）

### AC-2: 搜索结果按日期分组
**Given** 搜索返回跨多个日期的匹配结果
**When** 结果列表渲染完成
**Then** 搜索结果按日期降序分组，最新日期排在最前
**And** 每个日期分组复用 DateGroupHeader 组件，显示日期和该日期下的匹配结果数
**And** 分组头格式为"2026年2月26日 · 3条匹配"
**And** 日期分组之间间距 24px，分组头与第一张卡片间距 12px

### AC-3: 搜索关键词高亮
**Given** 搜索结果包含匹配的资讯标题和摘要
**When** 结果卡片渲染完成
**Then** 搜索关键词在标题和摘要中以高亮背景标记
**And** 高亮使用 `<mark>` 标签，背景色 #FEF3C7，圆角 2px，padding 1px 2px
**And** 高亮文字保持原色值不变（标题 #1A1A1A，摘要 #595959）
**And** 支持多关键词同时高亮（空格分词）

### AC-4: 搜索结果跳转到对应资讯位置
**Given** 用户看到搜索结果列表
**When** 用户点击某条搜索结果
**Then** 页面跳转到该资讯所在日期的页面（如 /daily/2026-02-26/）并定位到对应资讯位置（FR15）
**And** 跳转使用锚点定位（hash fragment），目标资讯卡片需具有唯一 id 属性
**And** 跳转后目标资讯卡片在视口中可见

### AC-5: 搜索状态栏
**Given** 用户执行搜索后
**When** 搜索结果页面渲染完成
**Then** 内容区顶部显示搜索状态栏，格式为 `搜索 "关键词" · 共 N 条结果`
**And** 关键词部分加粗（14px/600，#1A1A1A），其余文字 14px/400，#595959
**And** 结果数超过 100 时显示"共 100+ 条结果"
**And** 结果数为 0 时不显示计数，直接进入无结果状态

### AC-6: 无搜索结果友好提示
**Given** 用户执行搜索但无匹配结果
**When** Pagefind 返回空结果
**Then** 页面居中显示放大镜+问号图标（64px，#D9D9D9）
**And** 主提示文字：`未找到与 "关键词" 相关的资讯`（16px/600，#1A1A1A）
**And** 副提示包含搜索建议："试试更简短的关键词"、"检查是否有拼写错误"、"尝试使用相关的同义词"
**And** 副提示文字 14px/400，#8C8C8C

### AC-7: 搜索加载状态
**Given** 用户输入关键词触发搜索
**When** 搜索正在执行中
**Then** 显示骨架屏（Skeleton），3 个卡片占位符
**And** 骨架屏使用 #F0F0F0 背景色，animate-pulse 动画
**And** 搜索完成后骨架屏淡出，结果列表淡入（transition: opacity 0.2s ease）

### AC-8: 无障碍与键盘支持
**Given** 用户使用键盘或屏幕阅读器
**When** 在搜索页面操作
**Then** 搜索框支持 Escape 键清空输入并失焦（NFR15）
**And** 搜索框配合 aria-label="搜索资讯" 提供无障碍标签（NFR13）
**And** 搜索结果列表可通过 Tab 键逐条聚焦
**And** 高亮使用语义化 `<mark>` 标签，屏幕阅读器可识别

### AC-9: 移动端搜索结果适配
**Given** 用户在移动端（<768px）查看搜索结果
**When** 搜索结果页面渲染完成
**Then** 卡片全宽，padding 12px 16px（与首页移动端一致）
**And** 日期分组头字号缩小为 16px
**And** 搜索状态栏字号缩小为 13px，单行显示，超长关键词截断（text-overflow: ellipsis）
**And** 无结果状态图标缩小为 48px，建议标签换行排列（gap: 8px）

---

## 技术任务列表 (Technical Tasks)

### Task 1: 为资讯卡片添加锚点 ID
**预估时间：** 10 分钟
- 在 NewsCard 组件的 article 标签上添加唯一 id 属性
- id 格式建议：`news-{domain}-{index}` 或基于资讯标题的 slug
- 确保首页和日期页面的卡片均包含锚点 ID
- 验证锚点跳转后卡片在视口中正确可见

### Task 2: 自定义 Pagefind 搜索结果样式
**预估时间：** 30 分钟
- 覆盖 Pagefind UI 默认结果样式，使搜索结果卡片复用 NewsCard 视觉风格
- 配置 Pagefind 结果模板，展示领域 pill 标签和发布日期
- 实现关键词高亮样式（`<mark>` 标签，背景 #FEF3C7）
- 配置搜索结果链接指向日期页面 + 锚点（如 /daily/2026-02-26/#news-ai-1）

### Task 3: 实现搜索状态栏组件
**预估时间：** 15 分钟
- 创建搜索状态栏，显示搜索关键词和结果计数
- 关键词加粗样式（14px/600，#1A1A1A）
- 结果数超过 100 时显示"100+"
- 移动端适配：字号 13px，超长关键词截断

### Task 4: 实现搜索结果按日期分组
**预估时间：** 20 分钟
- 对 Pagefind 返回的结果按日期字段分组
- 复用 DateGroupHeader 组件渲染分组头
- 分组头显示匹配条数（非当日全部条数）
- 分组间距 24px，分组头与卡片间距 12px

### Task 5: 实现无结果状态页面
**预估时间：** 15 分钟
- 创建空状态组件：放大镜+问号图标（64px）
- 主提示文字和搜索建议列表
- 移动端适配：图标 48px，建议标签换行

### Task 6: 实现搜索加载骨架屏
**预估时间：** 10 分钟
- 创建 3 个卡片占位符的骨架屏组件
- 使用 #F0F0F0 背景色 + animate-pulse 动画
- 搜索完成后淡出过渡（opacity 0.2s ease）

### Task 7: 键盘交互与无障碍优化
**预估时间：** 10 分钟
- 搜索框 Escape 键清空并失焦
- 搜索框 aria-label="搜索资讯"
- 搜索结果列表 Tab 键导航
- 验证 `<mark>` 标签屏幕阅读器兼容性

---

## 非功能需求关联

| NFR | 描述 | 本 Story 中的实现 |
|-----|------|-------------------|
| NFR5 | 搜索响应 <=500ms | 搜索加载骨架屏提供感知性能优化 |
| NFR13 | 语义化 HTML | `<mark>` 高亮标签、aria-label、语义化结果列表 |
| NFR14 | 对比度 WCAG 2.1 AA | 高亮背景 #FEF3C7 与文字色对比度 >=4.5:1 |
| NFR15 | 键盘导航 | Escape 清空搜索、Tab 遍历结果、Enter 跳转 |

---

## 完成定义 (Definition of Done)

- [x] 搜索结果卡片展示领域 pill 标签和发布日期
- [x] 搜索结果按日期降序分组，分组头显示匹配条数
- [x] 搜索关键词在标题和摘要中高亮显示（`<mark>` 标签）
- [x] 点击搜索结果可跳转到对应日期页面并定位到资讯位置
- [x] 搜索状态栏正确显示关键词和结果计数
- [x] 无搜索结果时显示友好提示和搜索建议
- [x] 搜索加载中显示骨架屏动画
- [x] Escape 键可清空搜索框并失焦
- [x] 移动端搜索结果页面适配正确
- [x] 所有无障碍标签（aria-label、mark）正确设置

---

## 参考文档

- 架构设计：_bmad-output/planning-artifacts/architecture.md
- PRD：_bmad-output/planning-artifacts/prd.md
- UX 设计规范：_bmad-output/planning-artifacts/ux-design-specification.md（搜索结果页面设计章节）
- 设计稿：P3UuJ (Search-Desktop), 59Oal (Search-Mobile)
- Story 3-1：_bmad-output/implementation-artifacts/stories/story-3-1.md
