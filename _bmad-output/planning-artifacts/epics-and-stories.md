---
stepsCompleted: [step-01-validate-prerequisites, step-02-design-epics, step-03-create-stories, step-04-final-validation]
inputDocuments:
  - prd.md
  - architecture.md
  - ux-design-specification.md
workflowType: 'epics-and-stories'
status: 'complete'
completedAt: '2026-02-26'
project_name: 'Ai_auto_push'
---

# Ai_auto_push - Epic 分解

## 概述

本文档为 Ai_auto_push 项目提供完整的 Epic 和 Story 分解，将 PRD、UX 设计规范和架构文档中的需求转化为可实施的开发故事。

## 需求清单

### 功能需求

- FR1: 用户可以查看当天各领域的资讯列表
- FR2: 用户可以查看每条资讯的标题、摘要（150-200字）和原文链接
- FR3: 用户可以点击原文链接跳转至信息源原始页面
- FR4: 系统按日期分组展示资讯，每天一个独立页面
- FR5: 系统按时间轴纵向排列资讯条目
- FR6: 系统将资讯按领域分区展示（AI技术、跨境电商、产品创业、GitHub热门项目）
- FR7: 用户可以通过领域专属颜色编码、标题栏色条和卡片背景色区分不同领域的资讯区块
- FR8: 系统自动识别并适配新增的领域分区（通过 Skills 配置驱动）
- FR9: 用户可以通过时间线导航选择任意历史日期
- FR10: 用户可以浏览任意历史日期的资讯内容
- FR11: 用户可以一次点击切换至相邻日期（前一天/后一天）
- FR12: 用户可以通过关键词搜索资讯内容
- FR13: 搜索结果支持跨日期、跨领域匹配
- FR14: 搜索结果展示匹配的资讯标题、摘要片段和所属日期
- FR15: 用户可以从搜索结果直接跳转到对应资讯详情
- FR16: 系统每日自动执行抓取-整理-发布全链路流程
- FR17: 系统通过 Skills 配置文件定义各领域的信息源和抓取规则
- FR18: 用户可以通过新增 Skill 文件添加新的关注领域
- FR19: 系统将抓取内容自动整理为标准化 Markdown 格式（标题+摘要+链接）
- FR20: 系统自动将生成的 Markdown 文件推送至 Git 仓库触发站点构建
- FR21: 单个领域的抓取失败不影响其他领域的正常发布
- FR22: 系统通过 Git commit 记录提供运行状态可观测性
- FR23: 用户可以手动触发 Skills 执行进行故障恢复
- FR24: 系统在抓取失败时保留错误日志供排查
- FR25: 网站在桌面端（≥1024px）以多列布局展示领域分区
- FR26: 网站在移动端（<768px）以单列纵向布局展示内容
- FR27: 用户在任意设备上均可完成资讯浏览和搜索操作

### 非功能需求

- NFR1: 首屏内容绘制（FCP）≤1.5 秒
- NFR2: 最大内容绘制（LCP）≤2.5 秒
- NFR3: Lighthouse 性能评分 ≥90
- NFR4: 单页面总资源体积 ≤500KB
- NFR5: 客户端搜索响应时间 ≤500ms（1000 条资讯规模下）
- NFR6: 每日自动发布成功率 ≥99%
- NFR7: 单个领域抓取失败时，其余领域正常发布不受影响
- NFR8: 站点可用性 ≥99.9%（依赖 CDN/托管平台 SLA）
- NFR9: 自动化管道失败时，Git 仓库保留完整的错误日志
- NFR10: 站点通过 HTTPS 提供服务
- NFR11: 静态资源配置 CSP 头，至少包含 default-src 'self' 和 script-src 'self' 指令
- NFR12: 外部链接不泄露引用来源信息且不共享浏览器上下文
- NFR13: 语义化 HTML 标签，屏幕阅读器可完成标题跳转、区域导航和链接列表浏览
- NFR14: 颜色对比度符合 WCAG 2.1 AA 标准（≥4.5:1）
- NFR15: 支持键盘导航完成浏览资讯、切换日期、执行搜索三项核心操作

### 附加需求

- 架构指定使用 Astro Blog Starter 模板初始化项目（TypeScript strict + Tailwind CSS v4 + Pagefind）
- 部署目标为 GitHub Pages，通过 GitHub Actions 自动构建部署
- Content Collections 定义 Markdown 内容 schema，构建时类型校验
- 领域配置集中管理于 src/config/domains.ts，前端和管道共享
- Markdown 文件格式契约：frontmatter 包含 title, domain, date, itemCount, generatedAt
- 管道与前端通过 Git 仓库解耦，Markdown 文件为唯一通信通道
- UX 设计采用资讯列表式布局（News List Feed），单列纵向信息流 + pill 标签导航
- 领域色彩编码系统：AI技术(蓝)、跨境电商(橙)、产品创业(绿)、GitHub热门(紫)
- 响应式断点：桌面端 ≥1440px、平板端 768-1439px、移动端 <768px
- 无障碍要求：语义化 HTML、键盘导航、WCAG 2.1 AA 对比度

### FR 覆盖映射

| FR | Epic | 说明 |
|----|------|------|
| FR1 | Epic 1 | 首页展示当天资讯列表 |
| FR2 | Epic 1 | 资讯卡片包含标题、摘要、链接 |
| FR3 | Epic 1 | 原文链接跳转 |
| FR4 | Epic 2 | 按日期分组，独立日期页面 |
| FR5 | Epic 1 | 时间轴纵向排列 |
| FR6 | Epic 1 | 领域分区展示 |
| FR7 | Epic 1 | 领域色彩编码 |
| FR8 | Epic 1 | 新领域自动适配 |
| FR9 | Epic 2 | 时间线导航 |
| FR10 | Epic 2 | 历史日期浏览 |
| FR11 | Epic 2 | 前后日期切换 |
| FR12 | Epic 3 | 关键词搜索 |
| FR13 | Epic 3 | 跨日期跨领域搜索 |
| FR14 | Epic 3 | 搜索结果展示 |
| FR15 | Epic 3 | 搜索结果跳转 |
| FR16 | Epic 4 | 每日自动执行全链路 |
| FR17 | Epic 4 | Skills 配置信息源 |
| FR18 | Epic 4 | 新增 Skill 添加领域 |
| FR19 | Epic 4 | 自动整理为 Markdown |
| FR20 | Epic 4 | 自动推送 Git 触发构建 |
| FR21 | Epic 5 | 单领域失败隔离 |
| FR22 | Epic 5 | Git commit 可观测性 |
| FR23 | Epic 5 | 手动触发故障恢复 |
| FR24 | Epic 5 | 错误日志保留 |
| FR25 | Epic 1 | 桌面端多列布局 |
| FR26 | Epic 1 | 移动端单列布局 |
| FR27 | Epic 1 | 跨端浏览和搜索 |

## Epic 列表

### Epic 1: 项目基础与每日资讯展示
用户可以在桌面端和移动端浏览当天各领域的精选资讯，每条资讯包含标题、摘要和原文链接，领域通过色彩编码清晰区分。
**覆盖 FR：** FR1, FR2, FR3, FR5, FR6, FR7, FR8, FR25, FR26, FR27

### Epic 2: 历史导航与日期浏览
用户可以通过时间线导航浏览任意历史日期的资讯，支持日期跳转和前后日期切换。
**覆盖 FR：** FR4, FR9, FR10, FR11

### Epic 3: 搜索功能
用户可以通过关键词搜索跨日期、跨领域的资讯内容，搜索结果展示匹配信息并支持直接跳转。
**覆盖 FR：** FR12, FR13, FR14, FR15

### Epic 4: Skills 自动化内容管道
系统每日自动执行资讯抓取、AI 整理和发布的全链路流程，通过 Skills 配置驱动，输出标准化 Markdown 并推送至 Git 仓库。
**覆盖 FR：** FR16, FR17, FR18, FR19, FR20

### Epic 5: 系统可靠性、容错与部署
系统具备单领域失败隔离、错误日志、手动触发恢复能力，并通过 CI/CD 实现自动构建部署。
**覆盖 FR：** FR21, FR22, FR23, FR24


## Epic 1: 项目基础与每日资讯展示

**目标：** 用户可以在桌面端和移动端打开网站，浏览当天各领域的精选资讯。每条资讯包含标题、AI 生成的摘要和可点击的原文链接。四大领域通过色彩编码清晰区分，页面响应式适配各种设备。

### Story 1.1: 项目初始化与基础框架搭建

作为开发者，
我想要基于 Astro Blog Starter 模板初始化项目并安装核心依赖，
以便拥有一个可运行的项目骨架作为后续开发的基础。

**验收标准：**

**Given** 开发环境已安装 Node.js 和 pnpm
**When** 执行项目初始化命令使用 blog 模板和 TypeScript strict 模式
**Then** 项目成功创建，包含 Astro 5.x 基础结构
**And** Tailwind CSS v4 通过 @astrojs/tailwind 集成安装完成
**And** 开发服务器可以成功启动
**And** 构建命令可以成功生成静态输出
**And** tsconfig.json 配置为 strict 模式
**And** .gitignore 包含 node_modules、dist 等标准忽略项

**优先级：** P0（阻塞所有后续开发）
**复杂度：** 低

### Story 1.2: Content Collections Schema 与领域配置

作为开发者，
我想要定义 Content Collections schema 和领域配置文件，
以便系统能够类型安全地管理资讯内容并集中管理领域元数据。

**验收标准：**

**Given** 项目已初始化完成（Story 1.1）
**When** 创建 src/content/config.ts 定义 daily collection schema
**Then** schema 包含 title(string)、domain(string)、date(date)、itemCount(number)、generatedAt(string) 字段
**And** 构建时自动校验 Markdown frontmatter 格式，不合规文件触发构建错误
**And** src/config/domains.ts 包含四大领域配置（slug、name、color、order）
**And** 领域配置使用 TypeScript as const 确保类型安全
**And** 创建至少 2 天的测试 Markdown 数据文件，每天覆盖 4 个领域
**And** 每个测试文件包含 3-5 条资讯（标题 + 摘要 + 来源链接）

**优先级：** P0
**复杂度：** 低

### Story 1.3: 基础布局与 Header 组件

作为用户，
我想要看到一个清晰的页面布局，包含品牌标识和领域导航，
以便快速识别网站并切换不同领域的资讯。

**验收标准：**

**Given** Content Collections schema 和领域配置已就绪（Story 1.2）
**When** 用户打开网站首页
**Then** 页面使用 BaseLayout 布局，包含 Header、内容区和 Footer
**And** Header 高度 54px，白色背景，包含品牌 Logo（"资讯雷达"，22px/700，色值 #1677FF）
**And** Header 包含水平 pill 标签导航（全部/AI技术/跨境电商/产品创业/GitHub热门）
**And** pill 标签使用领域专属色彩编码（蓝/橙/绿/紫），圆角 16px，内边距 6px 16px
**And** 激活态 pill 背景色为 #1677FF，文字白色
**And** 页面背景色为 #F5F7FA，内容区最大宽度 1440px 居中
**And** Footer 包含版权信息和 GitHub 链接
**And** 语义化 HTML：Header 使用 header 标签，导航使用 nav 标签配合 aria-label
**And** pill 标签使用 role="tablist" / role="tab"，激活态标记 aria-selected="true"

**优先级：** P0
**复杂度：** 中

### Story 1.4: 每日资讯首页与新闻卡片组件

作为用户，
我想要在首页看到当天各领域的资讯列表，每条资讯包含标题、摘要和原文链接，
以便 30 秒内完成所有领域关键动态的浏览。

**验收标准：**

**Given** 基础布局和 Header 已完成（Story 1.3），且当天存在资讯数据
**When** 用户打开网站首页（/）
**Then** 页面自动展示最新日期的资讯内容
**And** 内容区顶部显示日期分组头：蓝色竖条(4px宽x20px高) + 日期文字(18px/600) + 计数 badge + 更新时间
**And** 资讯以白色卡片列表纵向排列，卡片圆角 8px，内边距 16px 20px
**And** 每张卡片包含：领域 pill 标签 + 来源/时间(12px, #8C8C8C) + 标题(16px/600, #1A1A1A) + 摘要(14px/400, #595959) + "阅读原文 →" 链接(13px/500, #1677FF)
**And** 标题最多两行截断，摘要最多三行截断
**And** 卡片悬停时显示阴影效果（box-shadow: 0 2px 8px rgba(0,0,0,0.08)），过渡 0.2s
**And** 原文链接点击后在新标签页打开（target="_blank"），并设置 rel="noopener noreferrer"（NFR12）
**And** 每条资讯使用 article 语义标签（NFR13）

**优先级：** P0
**复杂度：** 中

### Story 1.5: 领域筛选与色彩编码

作为用户，
我想要通过点击领域 pill 标签筛选特定领域的资讯，
以便快速聚焦到我当前最关心的领域动态。

**验收标准：**

**Given** 首页已展示全部领域资讯（Story 1.4）
**When** 用户点击某个领域 pill 标签（如"AI技术"）
**Then** 资讯列表仅显示该领域的资讯条目
**And** 被点击的 pill 标签切换为激活态（背景 #1677FF，文字白色）
**And** 点击"全部"标签恢复显示所有领域资讯
**And** 筛选切换无需页面刷新，客户端即时响应
**And** 每张卡片的领域 pill 标签颜色与 Header 导航中的领域色彩一致
**And** 键盘用户可通过 Tab 进入导航区，左右箭头键在 pill 间切换（NFR15）

**优先级：** P1
**复杂度：** 低

### Story 1.6: 响应式适配与跨端体验

作为用户，
我想要在手机和平板上也能舒适地浏览资讯，
以便在碎片时间通过移动设备获取信息。

**验收标准：**

**Given** 首页资讯展示功能已完成（Story 1.4）
**When** 用户在移动端（<768px）访问网站
**Then** 内容区 padding 缩小为 12px 16px
**And** Header 高度缩小为 48px，padding 0 16px
**And** pill 导航支持横向滚动，隐藏滚动条（scrollbar-width: none）
**And** 新闻卡片 padding 缩小为 12px 16px
**And** 日期分组头字号缩小为 16px

**When** 用户在平板端（768-1439px）访问网站
**Then** 内容区 padding 为 16px 24px
**And** Header padding 为 0 24px
**And** pill 导航保持水平排列，间距缩小为 gap 6px

**When** 用户在桌面端（>=1440px）访问网站
**Then** 内容区 max-width 1440px 居中，padding 24px 48px
**And** 所有可点击元素在移动端点击区域 >= 44x44px（NFR13）
**And** 所有文字与背景对比度 >= 4.5:1（NFR14）

**优先级：** P0
**复杂度：** 中

## Epic 2: 历史导航与日期浏览

**目标：** 用户可以通过时间线导航浏览任意历史日期的资讯内容，支持日期选择、前后日期切换，每天一个独立页面。

### Story 2.1: 日期动态路由与历史页面

作为用户，
我想要通过 URL 访问任意历史日期的资讯页面，
以便回顾过去某天的资讯内容。

**验收标准：**

**Given** 系统中存在多天的资讯数据
**When** 用户访问 /daily/2026-02-25/ 格式的 URL
**Then** 页面展示该日期的所有领域资讯，布局与首页一致
**And** 页面标题和日期分组头显示对应日期
**And** 不存在的日期返回友好的 404 提示页面
**And** Astro 通过 getStaticPaths 为所有有数据的日期生成静态页面
**And** 首页（/）自动重定向或展示最新日期的内容

**优先级：** P0
**复杂度：** 中

### Story 2.2: 前后日期切换导航

作为用户，
我想要一键切换到前一天或后一天的资讯，
以便快速连续浏览相邻日期的内容。

**验收标准：**

**Given** 用户正在浏览某个日期的资讯页面
**When** 用户点击"前一天"按钮
**Then** 页面跳转到前一天的资讯页面（如果存在数据）
**And** 如果前一天没有数据，按钮显示为禁用状态

**When** 用户点击"后一天"按钮
**Then** 页面跳转到后一天的资讯页面（如果存在数据）
**And** 如果已是最新日期，"后一天"按钮显示为禁用状态

**And** 导航按钮位于内容区顶部或底部，位置固定一致
**And** 按钮支持键盘操作（Tab 聚焦 + Enter 触发）（NFR15）
**And** 按钮包含 aria-label 说明跳转目标日期

**优先级：** P1
**复杂度：** 低

### Story 2.3: 归档页面与时间线导航

作为用户，
我想要查看所有历史日期的索引列表，
以便快速定位到任意历史日期的资讯。

**验收标准：**

**Given** 系统中存在多天的资讯数据
**When** 用户访问 /archive/ 页面
**Then** 页面展示所有有数据的日期列表，按时间倒序排列
**And** 每个日期条目显示日期、当天资讯总条数和覆盖的领域标签
**And** 点击日期条目跳转到对应的日期资讯页面
**And** 日期列表支持按月分组浏览
**And** 页面使用语义化 HTML，日期列表使用有序列表标签
**And** 键盘用户可通过 Tab 在日期条目间导航（NFR15）

**优先级：** P1
**复杂度：** 中

## Epic 3: 搜索功能

**目标：** 用户可以通过关键词搜索跨日期、跨领域的资讯内容，搜索结果展示匹配的标题、摘要片段和所属日期，并支持直接跳转到对应资讯。

### Story 3.1: Pagefind 搜索集成与搜索页面

作为用户，
我想要通过关键词搜索历史资讯内容，
以便快速找到我记忆中的某条资讯。

**验收标准：**

**Given** 网站已构建并部署，包含多天多领域的资讯内容
**When** 用户在 Header 搜索框中输入关键词并提交
**Then** 页面跳转到 /search/ 页面，展示匹配的搜索结果
**And** 搜索结果包含匹配的资讯标题、摘要片段（高亮关键词）和所属日期
**And** 搜索支持跨日期、跨领域匹配（FR13）
**And** 搜索响应时间 <=500ms（1000 条资讯规模下）（NFR5）
**And** Pagefind 在构建时自动索引所有生成的 HTML 页面
**And** 搜索索引随静态文件一起部署，无需后端服务

**优先级：** P1
**复杂度：** 中

### Story 3.2: 搜索结果展示与跳转

作为用户，
我想要从搜索结果直接跳转到对应的资讯详情页面，
以便快速阅读完整内容和访问原文链接。

**验收标准：**

**Given** 用户已执行搜索并看到结果列表
**When** 用户点击某条搜索结果
**Then** 页面跳转到该资讯所在日期的页面，并定位到对应资讯位置
**And** 搜索结果中每条记录显示所属领域的 pill 标签
**And** 搜索结果中显示资讯的发布日期
**And** 无搜索结果时显示友好提示（如"未找到匹配的资讯"）
**And** 搜索框支持 Escape 键清空输入并失焦（NFR15）
**And** 搜索框配合 aria-label="搜索资讯" 提供无障碍标签（NFR13）

**优先级：** P1
**复杂度：** 低

### Story 3.3: Header 常驻搜索框

作为用户，
我想要在任何页面都能快速发起搜索，
以便随时从浏览模式切换到搜索模式。

**验收标准：**

**Given** 用户在网站任意页面
**When** 用户点击 Header 右侧的搜索框
**Then** 搜索框获得焦点，背景变为白色，边框变为 1px solid #1677FF
**And** 搜索框默认态：圆角 20px，背景 #F5F5F5，无边框
**And** 占位文字为"搜索资讯..."，13px/400，色值 #BFBFBF
**And** 输入关键词后按 Enter 跳转到搜索结果页
**And** 搜索框在移动端（<768px）移至 Header 下方独立行，全宽显示

**优先级：** P1
**复杂度：** 低

## Epic 4: Skills 自动化内容管道

**目标：** 系统每日自动执行资讯抓取、AI 整理和发布的全链路流程。通过 Skills 配置文件驱动各领域的信息源定义和抓取规则，输出标准化 Markdown 文件并推送至 Git 仓库触发站点构建。

### Story 4.1: 管道入口与领域调度框架

作为系统运维者，
我想要一个管道入口脚本能够按领域独立调度执行抓取任务，
以便实现全链路自动化的基础框架。

**验收标准：**

**Given** 项目中存在 scripts/pipeline/ 目录
**When** 执行管道入口脚本 run.ts
**Then** 脚本从 src/config/domains.ts 读取所有领域配置
**And** 按顺序为每个领域执行抓取-筛选-格式化流程
**And** 每个领域的执行互相独立，单个领域失败不中断整体流程
**And** 执行完成后输出汇总日志（成功/失败领域数量）
**And** 支持通过命令行参数指定执行单个领域（用于调试）

**优先级：** P0
**复杂度：** 中

### Story 4.2: 资讯抓取模块（openclaw 集成）

作为系统运维者，
我想要系统能够通过 openclaw 从各领域信息源抓取原始资讯数据，
以便获取每日最新的资讯内容作为整理的输入。

**验收标准：**

**Given** 管道调度框架已就绪（Story 4.1），且 openclaw API 可用
**When** 抓取模块 fetch.ts 被调用并传入领域配置
**Then** 模块通过 openclaw API 从该领域配置的信息源抓取原始数据
**And** 抓取结果包含资讯标题、正文内容、来源 URL 和发布时间
**And** 抓取超时设置合理（单个源 <=30s），超时后跳过该源
**And** 抓取失败时抛出包含领域和错误详情的结构化错误
**And** 支持通过 Skills 配置文件定义每个领域的信息源列表（FR17）

**优先级：** P0
**复杂度：** 中


### Story 4.3: AI 内容筛选与摘要生成模块

作为系统运维者，
我想要系统能够通过大模型对抓取的原始资讯进行筛选和摘要生成，
以便输出高质量的精选资讯内容供用户浏览。

**验收标准：**

**Given** 抓取模块已返回某领域的原始资讯数据（Story 4.2）
**When** 筛选模块 filter.ts 被调用并传入原始资讯列表
**Then** 模块调用大模型 API 对资讯进行价值评估和去重筛选
**And** 每个领域筛选后保留 3-8 条高价值资讯
**And** 为每条资讯生成 150-200 字的中文摘要（FR2）
**And** 摘要准确反映原文核心内容，不产生幻觉信息
**And** 保留原始来源 URL 和发布时间，确保可追溯
**And** 大模型 API 调用失败时抛出结构化错误，不返回空结果

**优先级：** P0
**复杂度：** 高

### Story 4.4: Markdown 格式化输出模块

作为系统运维者，
我想要系统能够将筛选后的资讯自动格式化为标准 Markdown 文件，
以便前端 Content Collections 能够正确解析和展示。

**验收标准：**

**Given** 筛选模块已返回某领域的精选资讯列表（Story 4.3）
**When** 格式化模块 format.ts 被调用并传入筛选结果
**Then** 模块生成符合 Content Collections schema 的 Markdown 文件
**And** Frontmatter 包含 title、domain、date、itemCount、generatedAt 五个必填字段（FR19）
**And** 日期字段使用 YYYY-MM-DD 格式，与架构规范一致
**And** 每条资讯以 ## 二级标题分隔，包含摘要段落和来源链接
**And** 来源链接格式固定为 **来源：** [名称](URL)
**And** 输出文件路径为 src/content/daily/{date}/{domain-slug}.md
**And** 文件编码为 UTF-8，换行符为 LF

**优先级：** P0
**复杂度：** 低

### Story 4.5: Git 自动提交与推送模块

作为系统运维者，
我想要系统能够将生成的 Markdown 文件自动提交并推送至 Git 仓库，
以便触发站点自动构建和部署流程。

**验收标准：**

**Given** 格式化模块已生成当天所有领域的 Markdown 文件（Story 4.4）
**When** 发布模块 publish.ts 被调用
**Then** 模块执行 git add 将新生成的 Markdown 文件加入暂存区
**And** 执行 git commit，commit message 包含日期、成功/失败领域数量和执行摘要（FR22）
**And** 执行 git push 将变更推送至远程 main 分支（FR20）
**And** push 成功后输出确认日志
**And** push 失败时重试最多 3 次，仍失败则记录错误并退出
**And** commit message 格式示例："chore: daily update 2026-02-26 (4/4 domains succeeded)"

**优先级：** P0
**复杂度：** 低

### Story 4.6: Skills 配置与新领域扩展机制

作为系统运维者，
我想要通过新增 Skills 配置文件即可添加新的关注领域，
以便无需修改代码即可扩展资讯覆盖范围。

**验收标准：**

**Given** 管道框架和各功能模块已就绪（Story 4.1-4.5）
**When** 用户在 Skills 目录中新增一个领域配置文件
**Then** 配置文件定义领域名称、信息源列表、抓取规则和输出格式（FR17）
**And** 同步在 src/config/domains.ts 中添加对应领域元数据（slug、name、color、order）
**And** 下次管道执行时自动发现并处理新领域（FR18）
**And** 新领域的资讯在网站上自动展示，无需修改前端代码（FR8）
**And** 提供至少一个完整的 Skills 配置示例作为模板
**And** Skills 配置文件包含必要的注释说明各字段用途

**优先级：** P1
**复杂度：** 低


## Epic 5: 系统可靠性、容错与部署

**目标：** 系统具备单领域失败隔离能力，通过 Git commit 记录提供运行状态可观测性，支持手动触发故障恢复，并通过 GitHub Actions CI/CD 实现自动构建部署到 GitHub Pages。

### Story 5.1: 单领域失败隔离机制

作为系统运维者，
我想要单个领域的抓取或处理失败不影响其他领域的正常发布，
以便最大化每日资讯的覆盖完整度。

**验收标准：**

**Given** 管道正在执行多个领域的抓取任务
**When** 某个领域（如"跨境电商"）的抓取过程抛出异常
**Then** 该领域的错误被捕获并记录，不中断管道整体执行（FR21）
**And** 其余领域继续正常执行抓取-筛选-格式化-写入流程
**And** 最终 Git commit 中包含成功领域的 Markdown 文件
**And** commit message 明确标注失败领域及错误摘要（如 "3/4 domains succeeded, failed: ecommerce (timeout)"）
**And** 失败领域不生成空文件或损坏文件
**And** 前端渲染时自动跳过缺失领域，不显示空分区

**优先级：** P0
**复杂度：** 中

### Story 5.2: Git Commit 运行状态可观测性

作为系统运维者，
我想要通过 Git commit 记录了解每日管道的运行状态，
以便无需额外监控工具即可判断系统是否正常运行。

**验收标准：**

**Given** 管道执行完成（无论成功或部分失败）
**When** 查看 Git 仓库的 commit 历史
**Then** 每次管道执行生成一条 commit 记录（FR22）
**And** commit message 包含执行日期、成功领域数/总领域数
**And** commit message 包含每个领域的执行状态（成功/失败/跳过）
**And** 失败领域的 commit message 包含错误类型摘要（如 timeout、api_error）
**And** 无新内容时不生成空 commit
**And** commit 时间戳准确反映管道执行时间

**优先级：** P1
**复杂度：** 低

### Story 5.3: 手动触发与故障恢复

作为系统运维者，
我想要能够手动触发管道执行进行故障恢复，
以便在自动执行失败时快速修复并补发当日资讯。

**验收标准：**

**Given** 当日自动管道执行失败或部分失败
**When** 运维者通过 GitHub Actions 手动触发 pipeline workflow
**Then** 管道重新执行完整的抓取-筛选-格式化-发布流程（FR23）
**And** 支持通过 workflow_dispatch 参数指定执行单个领域（用于定向修复）
**And** 手动触发的执行与自动触发使用相同的管道代码路径
**And** 手动执行的结果同样通过 Git commit 记录可观测
**And** 重复执行同一天的管道会覆盖已有的 Markdown 文件（幂等性）

**优先级：** P1
**复杂度：** 低

### Story 5.4: 错误日志持久化

作为系统运维者，
我想要管道执行失败时保留详细的错误日志，
以便快速定位和排查问题根因。

**验收标准：**

**Given** 管道执行过程中某个环节发生错误
**When** 错误被捕获并处理
**Then** 错误日志包含时间戳、领域标识、错误阶段（抓取/筛选/格式化/推送）和完整错误堆栈（FR24）
**And** 错误日志写入 Git 仓库的 logs/ 目录，随代码一起版本化
**And** 日志文件按日期命名（如 logs/2026-02-26-errors.log）
**And** GitHub Actions 运行日志中同步输出错误详情（NFR9）
**And** 日志内容不包含敏感信息（如 API 密钥）

**优先级：** P1
**复杂度：** 低

### Story 5.5: GitHub Actions CI/CD 部署流水线

作为系统运维者，
我想要通过 GitHub Actions 实现站点的自动构建和部署，
以便管道推送新内容后网站自动更新，无需人工干预。

**验收标准：**

**Given** 管道已将新的 Markdown 文件推送至 main 分支
**When** GitHub Actions 检测到 main 分支的 push 事件
**Then** 自动触发构建流水线，执行 pnpm install 和 astro build
**And** Pagefind 在构建后自动索引所有生成的 HTML 页面
**And** 构建产物通过 actions/upload-pages-artifact 上传
**And** GitHub Pages 自动从 artifact 部署静态站点
**And** 站点通过 HTTPS 提供服务（NFR10）
**And** 构建失败时通过 GitHub 通知机制告警
**And** 部署完成后站点可在 5 分钟内访问到最新内容

**优先级：** P0
**复杂度：** 中


## 附录：FR 覆盖验证矩阵

> 验证日期：2026-02-26
> 验证方法：逐条比对 PRD FR1-FR27 与 Epic/Story 验收标准

### 完整覆盖矩阵

| FR | 描述 | Epic | 覆盖 Story | 覆盖状态 |
|----|------|------|-----------|----------|
| FR1 | 查看当天各领域资讯列表 | Epic 1 | Story 1.4 | ✅ 完整覆盖 |
| FR2 | 标题、摘要(150-200字)、原文链接 | Epic 1 | Story 1.4, Story 4.3 | ✅ 完整覆盖 |
| FR3 | 点击原文链接跳转原始页面 | Epic 1 | Story 1.4 | ✅ 完整覆盖 |
| FR4 | 按日期分组，每天独立页面 | Epic 2 | Story 2.1 | ✅ 完整覆盖 |
| FR5 | 时间轴纵向排列资讯条目 | Epic 1 | Story 1.4 | ✅ 完整覆盖 |
| FR6 | 按领域分区展示 | Epic 1 | Story 1.4, Story 1.5 | ✅ 完整覆盖 |
| FR7 | 领域专属颜色编码 | Epic 1 | Story 1.3, Story 1.5 | ⚠️ 部分覆盖 |
| FR8 | 自动适配新增领域分区 | Epic 1 | Story 4.6 | ✅ 完整覆盖 |
| FR9 | 时间线导航选择历史日期 | Epic 2 | Story 2.3 | ✅ 完整覆盖 |
| FR10 | 浏览任意历史日期资讯 | Epic 2 | Story 2.1 | ✅ 完整覆盖 |
| FR11 | 一次点击切换相邻日期 | Epic 2 | Story 2.2 | ✅ 完整覆盖 |
| FR12 | 关键词搜索资讯内容 | Epic 3 | Story 3.1 | ✅ 完整覆盖 |
| FR13 | 跨日期、跨领域匹配 | Epic 3 | Story 3.1 | ✅ 完整覆盖 |
| FR14 | 搜索结果展示标题、摘要片段、日期 | Epic 3 | Story 3.1, Story 3.2 | ✅ 完整覆盖 |
| FR15 | 搜索结果跳转资讯详情 | Epic 3 | Story 3.2 | ✅ 完整覆盖 |
| FR16 | 每日自动执行全链路流程 | Epic 4 | Story 4.1 | ✅ 完整覆盖 |
| FR17 | Skills配置定义信息源和抓取规则 | Epic 4 | Story 4.2, Story 4.6 | ✅ 完整覆盖 |
| FR18 | 新增Skill文件添加新领域 | Epic 4 | Story 4.6 | ✅ 完整覆盖 |
| FR19 | 自动整理为标准化Markdown | Epic 4 | Story 4.4 | ✅ 完整覆盖 |
| FR20 | 自动推送Git仓库触发构建 | Epic 4 | Story 4.5 | ✅ 完整覆盖 |
| FR21 | 单领域失败不影响其他领域 | Epic 5 | Story 5.1 | ✅ 完整覆盖 |
| FR22 | Git commit记录运行状态可观测性 | Epic 5 | Story 5.2 | ✅ 完整覆盖 |
| FR23 | 手动触发Skills执行故障恢复 | Epic 5 | Story 5.3 | ✅ 完整覆盖 |
| FR24 | 抓取失败保留错误日志 | Epic 5 | Story 5.4 | ✅ 完整覆盖 |
| FR25 | 桌面端多列布局 | Epic 1 | Story 1.6 | ⚠️ 部分覆盖 |
| FR26 | 移动端单列布局 | Epic 1 | Story 1.6 | ✅ 完整覆盖 |
| FR27 | 任意设备浏览和搜索 | Epic 1 | Story 1.6, Story 3.3 | ✅ 完整覆盖 |

### 覆盖统计

- **完整覆盖：** 25/27 (92.6%)
- **部分覆盖：** 2/27 (7.4%)
- **未覆盖：** 0/27 (0%)

### 部分覆盖项分析

**FR7（领域专属颜色编码 - 标题栏色条和卡片背景色）：**
- Story 1.3 覆盖了 pill 标签的领域色彩
- Story 1.5 覆盖了领域筛选与色彩编码
- **缺口：** PRD 和 UX 设计稿明确要求"卡片背景色"按领域区分（AI:#EFF6FF, 跨境电商:#ECFDF5, 产品创业:#FFFBEB, GitHub:#F5F3FF），但 Story 1.4 的验收标准中卡片描述为"白色卡片"，未体现领域专属卡片背景色
- **修复：** 见下方补充 Story 1.4 验收标准

**FR25（桌面端多列布局展示领域分区）：**
- Story 1.6 覆盖了响应式断点和间距适配
- **缺口：** Story 1.6 桌面端验收标准仅描述"max-width 1440px 居中"，未明确提及"多列布局展示领域分区"
- **修复：** 见下方补充 Story 1.6 验收标准

### 补充验收标准

#### Story 1.4 补充（修复 FR7 覆盖缺口）

在 Story 1.4 现有验收标准基础上，追加以下条目：

**And** 每张资讯卡片的背景色根据所属领域动态设置，使用领域专属浅色背景：
- AI技术领域：卡片背景 #EFF6FF
- 跨境电商领域：卡片背景 #ECFDF5
- 产品创业领域：卡片背景 #FFFBEB
- GitHub热门领域：卡片背景 #F5F3FF
**And** 每个领域分区的标题栏包含领域主色色条（4px 宽竖条），色值与领域主色一致（蓝#3B82F6/绿#10B981/琥珀#F59E0B/紫#8B5CF6）

#### Story 1.6 补充（修复 FR25 覆盖缺口）

在 Story 1.6 现有验收标准的桌面端部分，追加以下条目：

**When** 用户在桌面端（>=1440px）访问网站
**Then** 领域分区以多列网格布局展示（2列或以上），每列包含一个领域的资讯卡片列表
**And** 列间距 24px，各列等宽分配可用空间
**And** 当领域数量为奇数时，最后一个领域占据完整行宽

**When** 用户在平板端（768-1439px）访问网站
**Then** 领域分区以双列布局展示，每行两个领域并排
