---
import type { DomainSlug } from '../../config/domains';
import { domains } from '../../config/domains';

interface Props {
	title: string;
	summary: string;
	sourceUrl: string;
	sourceName: string;
	domain: DomainSlug;
	anchorId?: string;
	date?: string;
	originalUrl?: string;
}

const { title, summary, sourceUrl, sourceName, domain, anchorId, date, originalUrl } = Astro.props;
const linkUrl = originalUrl || sourceUrl;

const domainConfig = domains.find((d) => d.slug === domain);
const bgColor = domainConfig?.bgColor ?? '#FFFFFF';
const pillBg = domainConfig?.pillBg ?? '#F5F5F5';
const pillText = domainConfig?.pillText ?? '#595959';
const domainName = domainConfig?.name ?? domain;
---

<article class="news-card" style={`background-color: ${bgColor};`} data-pagefind-body id={anchorId || undefined} data-pagefind-meta={anchorId ? `anchor:${anchorId}` : undefined}>
	{date && <span data-pagefind-meta={`date:${date}`} style="display:none;"></span>}
	<span data-pagefind-meta={`domain_slug:${domain}`} style="display:none;"></span>
	<div class="card-header">
		<span class="domain-pill" style={`background: ${pillBg}; color: ${pillText};`} data-pagefind-filter="domain">{domainName}</span>
		<span class="source-info" data-pagefind-meta="source">{sourceName}</span>
	</div>
	<h3 class="card-title" data-pagefind-meta="title" id={anchorId ? `heading-${anchorId}` : undefined}>
		<a href={linkUrl} target="_blank" rel="noopener noreferrer">
			{title}
		</a>
	</h3>
	<p class="card-summary">{summary}</p>
	<a
		class="read-more"
		href={linkUrl}
		target="_blank"
		rel="noopener noreferrer"
		aria-label={`阅读原文：${title}`}
	>
		阅读原文 →
	</a>
</article>

<style>
	.news-card {
		border-radius: 8px;
		padding: 16px 20px;
		transition: box-shadow 0.2s ease;
	}
	.news-card:hover {
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
	}
	.card-header {
		display: flex;
		align-items: center;
		gap: 8px;
		margin-bottom: 8px;
	}
	.domain-pill {
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		line-height: 1;
		padding: 4px 10px;
		border-radius: 10px;
		white-space: nowrap;
	}
	.source-info {
		font-size: 12px;
		color: #8C8C8C;
	}
	.card-title {
		font-size: 16px;
		font-weight: 600;
		color: #1A1A1A;
		line-height: 1.5;
		margin: 0 0 6px;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	.card-title a {
		color: inherit;
		text-decoration: none;
	}
	.card-title a:hover {
		color: #1677FF;
	}
	.card-summary {
		font-size: 14px;
		font-weight: 400;
		color: #595959;
		line-height: 1.6;
		margin: 0 0 10px;
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	.read-more {
		font-size: 13px;
		font-weight: 500;
		color: #1677FF;
		text-decoration: none;
		display: inline-flex;
		align-items: center;
		min-height: 44px;
		padding-top: 8px;
		padding-bottom: 8px;
	}
	.read-more:hover {
		text-decoration: underline;
	}

	/* Mobile: <768px */
	@media (max-width: 767px) {
		.news-card {
			padding: 12px 16px;
		}
		.card-title a {
			display: inline-flex;
			align-items: center;
			min-height: 44px;
		}
	}
</style>
